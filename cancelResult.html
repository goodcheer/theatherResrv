<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>

    <!-- W3school -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="mystyle.css">

    <style>
        .seat {
            background: black;
            color : white;
            padding : 10px;
        }

        .rowName{

          border: solid;
          background: white;
          padding:10px;
        }

        .reserved {
            background: Darkgrey;

        }

        .my-reserve {
            background: blue;

        }

    </style>
    <script src="utils/localStorageHelper.js"></script>

</head>
<body>
<div class="w3-center" id = "movieTitle">
</div>
<div class="w3-center">
  <table id="thread-table" align="center">
      <thead>
      <tr>
          <th id="screen">screen</th>
      </tr>
      </thead>
      <tbody id="thread-seat" data-row="" data-column="">

      </tbody>
  </table>
</div>

  <button onclick = "window.location='user_and_resv.html';"> 내 정보로 </button>
</body>

<script>
function isReserved(rowcol){
  for (var i = 0; i < threadInfo.reserveList.length; i++){
    if (threadInfo.reserveList[i].seat == rowcol )
    return true;
  }
  return false;
}


//페이지 로드시 수행
//테이블 정보
var threadInfo = {
    threadName : '좌석',
    row: 13,
    column: 12,
    reserveList: []
};
var resv_info = localStorage.getItem("resv_info");
console.log(resv_info);
if(resv_info === null ){
  resv_info = [];
}else{
  resv_info = JSON.parse(resv_info);
  console.log(resv_info);
}

for (var i = 0; i<resv_info.length; i++){
  console.log(resv_info[i]);
  if (resv_info[i].movie==null){
    continue;
  }

  if(sessionStorage.getItem("movieTitle") == resv_info[i].movie){
      threadInfo.reserveList.push(resv_info[i]);
  }

}

console.log(threadInfo.reserveList);

//현재 영화에 대한 정보와 회원정보를 출력
var movieTitle = sessionStorage.getItem("movieTitle");
mvt = document.createElement('h3');
mvt.innerHTML= '영화 제목 [ '+ movieTitle +' ]';

//local에서 상영 무비 가져오기
var localmovie = localStorage.getItem("movie");
if(localmovie === null){localmovie = [];}
else{localmovie = JSON.parse(localmovie);}

//local의 movie에서 date 가져와서 movieTitle에 저장. 내 마음 속에 저장
for (var i=0; i<localmovie.length; i++){
  if (movieTitle == localmovie[i].movie_name){
    var movieTime = localmovie[i].date;
  }
}

var mtstr = '상영 일시 [ ' + movieTime + ' ]';
mt = document.createElement('h3');
mt.innerHTML = mtstr;


var name = sessionStorage.getItem("name");
usn = document.createElement('h3');
usn.innerHTML = name+' 님의 예약취소결과';

var myid = sessionStorage.getItem("id");

document.querySelector('#movieTitle').appendChild(mvt);
document.querySelector('#movieTitle').appendChild(usn);
document.querySelector('#movieTitle').appendChild(mt);

// 좌석 생성
for (let i = 0; i < threadInfo.row; i++) {
    let threadRow = document.createElement('tr');
    for (let j = 0; j < threadInfo.column; j++) {
        let seat = document.createElement('td');
        const row = String.fromCharCode(65 + i);
        if (j==0) {
          seat.className = 'rowName';
          seat.dataset.row = row;
          seat.dataset.column = j;
          seat.innerHTML = row;
        }
        else{
          seat.className = 'seat';
          seat.dataset.row = row;
          seat.dataset.column = j;
          seat.innerHTML = row + j;
          if(isReserved(row+j)){
            seat.classList.add('reserved');
            seat.innerHTML = "X";
          }
        }
        threadRow.appendChild(seat);
    }
    document.querySelector('#thread-seat').appendChild(threadRow);
}
//예매 시도 관리
</script>
</html>
