<!DOCTYPE html>

<html>

<head>
    <title> 영화.home </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- W3school -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/css/swiper.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/css/swiper.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/js/swiper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/js/swiper.min.js"></script>
    <script src="utils/localStorageHelper.js"></script>
	<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
    <link rel="stylesheet" type="text/css" href="mystyle.css">
    <style>
    </style>
<script>
var seatNum = [];
</script>
</head>

<body>

<!-- Sidebar 사이드바 -->
<div class="w3-sidebar w3-bar-block w3-card w3-animate-right" style="display:none;right:0;z-index:1001; background: rgba(0, 0, 0, 0.6);" id="rightMenu">
    <button onclick="closeRightMenu()" class="w3-bar-item w3-button w3-large">닫기 &times;</button>
    <div class="imgcontainer" style="margin-bottom: 3em;">
        <img src="profile/face.png" alt="문지기" class="avatar">
    </div>
    <div class="w3-light-grey" style="margin:auto !important; width:80% !important; border-radius:15px;">

        <div class="container">

            <label><b>자네 ID가 뭔가</b></label>
            <input type="text" id="id-input"placeholder="성함이 무엇입니까?" name="uname" required>

            <label><b>암호를 대라</b></label>
            <input type="password" id="password-input" placeholder="비밀번호가 무엇입니까?" name="psw" required>

            <button onclick="requestSignIn()">좋아.. 들어가게 해주지..</button>
        </div>

    </div>
    <p style="text-align:center; margin-top: 6em;">
        <a class="w3-button w3-red" id="sign-in-request" href="singup.html">회원가입</a>
    </p>

</div>


<!-- Header -->
<header class="w3-container w3-theme w3-padding" id="myHeader">
    <i onclick="openRightMenu()" class="fa fa-bars w3-xlarge w3-button w3-theme w3-right"></i>
    <div class="w3-center">
        <h1 class="w3-xxxlarge w3-animate-bottom">가상세계 매표소</h1>
    </div>
</header>

<script>
    function openRightMenu() {
        var x = document.getElementById("rightMenu");
        x.style.width = "30%";
        x.style.display = "block";
    }

    function closeRightMenu() {
        document.getElementById("rightMenu").style.display = "none";
    }

    function requestSignIn(){
        const id = document.querySelector('#id-input').value;
        const pass = document.querySelector('#password-input').value;
        var users = localStorage.getItem('user_info');
		if(users === null){
			alert("일치하는 회원정보가 없습니다.")
		}
		var users = JSON.parse(users);

        const user = users.find(function (user) {
            return user.id === id && user.pw === pass;
        });
        if(user === undefined){
            alert('일치하는 회원정보가 없습니다.')
        }else{
            location.href = 'main_client.html';
			sessionStorage.setItem('id',id);

			for(i=0; i<users.length; i++){
			if(users[i].id === id){
				sessionStorage.setItem("name",users[i].name);
				sessionStorage.setItem("phone",users[i].phone);
				sessionStorage.setItem("resvNum",users[i].resvNum);
			}
		}

        }

    }

	function getSeatNum(movieName){
		var booked = localStorage.getItem("booked");
		booked = JSON.parse(booked);
		var vacant = 143;
		for(i=0; i < booked.length; i++){
			if(booked[i] == movieName) vacant--;
		}
		seatNum.push(vacant.toString());
	}
</script>

<!-- Touch Slider -->

<!-- Swiper -->
<div class="swiper-container w3-theme" style="width:100%">
	<h6 align=center>절찬리에 상영중</h6>
    <div class="swiper-wrapper" id="swiper-wrapper" onclick = "alert('로그인이 필요하다.')">
    </div>
    <!-- Add Pagination -->
    <div class="swiper-pagination"></div>
</div>


<script>
<!-- 영화 목록생성 -->
	$( document ).ready(function(){
	  var movie = localStorage.getItem("movie");
	  movie = JSON.parse(movie);
	  console.log(movie.length);

	  var i = 0;

	  var str = "";
	  while(i<movie.length){
	  getSeatNum(movie[i].movie_name);

	  str = str + '<div class = "swiper-slide"> 잔여 좌석: '+ seatNum[i] + '석 \
		<img src= "poster/' + movie[i].poster + '" width="100%"></div>';
	   i++;
	  }
      $('#swiper-wrapper').html(str);
      <!-- Initialize Swiper -->
		var swiper = new Swiper('.swiper-container', {
			effect: 'coverflow',
			grabCursor: true,
			centeredSlides: true,
			slidesPerView: 'auto',
			coverflowEffect: {
				rotate: 50,
				stretch: 0,
				depth: 100,
				modifier: 1,
				slideShadows: true,
			},
			pagination: {
				el: '.swiper-pagination',
			},
		});
    });


</script>

</body>
</html>
